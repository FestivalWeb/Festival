<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€ API í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .section { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 8px; background: #f9f9f9; }
        h2 { margin-top: 0; color: #333; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9em; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px;}
        button { margin-top: 15px; padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background-color: #0056b3; }
        button.danger { background-color: #dc3545; }
        button.danger:hover { background-color: #a71d2a; }
        pre { background: #333; color: #fff; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .row { display: flex; gap: 10px; }
        .row > div { flex: 1; }
    </style>
</head>
<body>

    <h1>ğŸ‘¤ ë§ˆì´í˜ì´ì§€ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="section" style="border-color: #007bff; background-color: #e7f1ff;">
        <h2>ğŸ”‘ ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜ (í•„ìˆ˜)</h2>
        <label>í…ŒìŠ¤íŠ¸í•  ì‚¬ìš©ì ID (DBì˜ user_id):</label>
        <input type="text" id="targetUserId" placeholder="ì˜ˆ: 4580513596" value="">
        <p style="font-size: 0.8em; color: #666;">* ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¤ì§€ë§Œ, í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì§ì ‘ ì…ë ¥í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="section">
        <h2>1. ë‚´ ì •ë³´ ì¡°íšŒ (GET)</h2>
        <button onclick="getProfile()">ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <div id="profileResult"></div>
    </div>

    <div class="section">
        <h2>2. íšŒì› ì •ë³´ ìˆ˜ì • (PUT)</h2>
        <div class="row">
            <div>
                <label>ì´ë¦„ (ë‹‰ë„¤ì„)</label>
                <input type="text" id="editName">
            </div>
            <div>
                <label>ì„±ë³„</label>
                <select id="editSex">
                    <option value="">ì„ íƒ ì•ˆ í•¨</option>
                    <option value="Male">ë‚¨ì„±</option>
                    <option value="Female">ì—¬ì„±</option>
                </select>
            </div>
        </div>
        <div class="row">
            <div>
                <label>íœ´ëŒ€ì „í™”</label>
                <input type="text" id="editPhone" placeholder="010-1234-5678">
            </div>
            <div>
                <label>ìƒë…„ì›”ì¼</label>
                <input type="date" id="editBirth">
            </div>
        </div>
        <label>êµ­ì </label>
        <input type="text" id="editNation" placeholder="Republic of Korea">
        
        <button onclick="updateProfile()">ì •ë³´ ìˆ˜ì •í•˜ê¸°</button>
    </div>

    <div class="section">
        <h2>3. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (PUT)</h2>
        <label>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="currentPw">
        <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="newPw">
        <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        <input type="password" id="confirmPw">
        <button onclick="changePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
    </div>

    <div class="section" style="border-color: #dc3545; background-color: #fff5f5;">
        <h2>4. íšŒì› íƒˆí‡´ (DELETE)</h2>
        <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        <input type="password" id="withdrawPw">
        <button class="danger" onclick="withdrawUser()">íšŒì› íƒˆí‡´</button>
    </div>

    <script>
        const BASE_URL = "http://localhost:8080/users";

        function getUserId() {
            const id = document.getElementById("targetUserId").value;
            if (!id) { alert("ë§¨ ìœ„ 'ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜' ì¹¸ì— IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return null; }
            return id;
        }

        // 1. ì¡°íšŒ
        async function getProfile() {
            const userId = getUserId();
            if(!userId) return;

            try {
                const res = await fetch(`${BASE_URL}/me?userId=${userId}`);
                const data = await res.json();
                
                if(res.ok) {
                    document.getElementById("profileResult").innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                    // ìˆ˜ì • í¼ì— ë°ì´í„° ì±„ì›Œë„£ê¸° (í¸ì˜ ê¸°ëŠ¥)
                    document.getElementById("editName").value = data.name || "";
                    document.getElementById("editPhone").value = data.phoneNumber || "";
                    document.getElementById("editNation").value = data.nationality || "";
                    document.getElementById("editBirth").value = data.birthDate || "";
                    document.getElementById("editSex").value = data.sex || "";
                } else {
                    alert("ì¡°íšŒ ì‹¤íŒ¨: " + JSON.stringify(data));
                }
            } catch (e) { alert("ì—ëŸ¬ ë°œìƒ: " + e); }
        }

        // 2. ìˆ˜ì •
        async function updateProfile() {
            const userId = getUserId();
            if(!userId) return;

            const dto = {
                name: document.getElementById("editName").value,
                sex: document.getElementById("editSex").value,
                phoneNumber: document.getElementById("editPhone").value,
                birthDate: document.getElementById("editBirth").value || null, // ë‚ ì§œ ì—†ìœ¼ë©´ null
                nationality: document.getElementById("editNation").value
            };

            try {
                const res = await fetch(`${BASE_URL}/me?userId=${userId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(dto)
                });
                
                if(res.ok) {
                    alert("ìˆ˜ì • ì„±ê³µ!");
                    getProfile(); // ìˆ˜ì •ëœ ë‚´ìš© ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
                } else {
                    const text = await res.text();
                    alert("ìˆ˜ì • ì‹¤íŒ¨: " + text);
                }
            } catch (e) { alert("ì—ëŸ¬ ë°œìƒ: " + e); }
        }

        // 3. ë¹„ë²ˆ ë³€ê²½
        async function changePassword() {
            const userId = getUserId();
            if(!userId) return;

            const dto = {
                currentPassword: document.getElementById("currentPw").value,
                newPassword: document.getElementById("newPw").value,
                confirmPassword: document.getElementById("confirmPw").value
            };

            try {
                const res = await fetch(`${BASE_URL}/password?userId=${userId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(dto)
                });

                const text = await res.text();
                if(res.ok) {
                    alert("ì„±ê³µ: " + text);
                    // ì…ë ¥ì°½ ë¹„ìš°ê¸°
                    document.getElementById("currentPw").value = "";
                    document.getElementById("newPw").value = "";
                    document.getElementById("confirmPw").value = "";
                } else {
                    alert("ì‹¤íŒ¨: " + text);
                }
            } catch (e) { alert("ì—ëŸ¬ ë°œìƒ: " + e); }
        }

        // 4. íƒˆí‡´
        async function withdrawUser() {
            const userId = getUserId();
            if(!userId) return;
            
            const pw = document.getElementById("withdrawPw").value;
            if(!pw) { alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            if(!confirm("ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëŒì´í‚¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;

            try {
                const res = await fetch(`${BASE_URL}/me?userId=${userId}&password=${pw}`, {
                    method: "DELETE"
                });

                const text = await res.text();
                if(res.ok) {
                    alert("íƒˆí‡´ ì™„ë£Œ: " + text);
                    location.reload(); // ìƒˆë¡œê³ ì¹¨
                } else {
                    alert("íƒˆí‡´ ì‹¤íŒ¨: " + text);
                }
            } catch (e) { alert("ì—ëŸ¬ ë°œìƒ: " + e); }
        }
    </script>
</body>
</html>